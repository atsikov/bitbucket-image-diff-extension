(()=>{"use strict";var e={485:(e,t,i)=>{i.r(t),i.d(t,{default:()=>n});const n={}},439:(e,t,i)=>{i.r(t),i.d(t,{default:()=>n});const n={"diff-backdrop":"diff-image-ext__diff-backdrop-hQEzP","diff-container":"diff-image-ext__diff-container-cuBly","diff-panel":"diff-image-ext__diff-panel-SWlbL","diff-item-container":"diff-image-ext__diff-item-container-yxFAW","diff-item-before":"diff-image-ext__diff-item-before-GNdlU","diff-item-after":"diff-image-ext__diff-item-after-gPeBm","diff-item-image":"diff-image-ext__diff-item-image-M8LmM","diff-difference":"diff-image-ext__diff-difference-a2ZLN","diff-overlay":"diff-image-ext__diff-overlay-dQBOp","diff-overlay-alpha-input":"diff-image-ext__diff-overlay-alpha-input-Qq2Fc","diff-images-stack":"diff-image-ext__diff-images-stack-ZRjIP",hidden:"diff-image-ext__hidden-mYsDU","diff-image-stats":"diff-image-ext__diff-image-stats-jOvbq"}},456:(e,t,i)=>{i.r(t),i.d(t,{default:()=>n});const n={hidden:"diff-image-ext__hidden-At6VP","image-diff-tabs":"diff-image-ext__image-diff-tabs-Qylir",tab:"diff-image-ext__tab-vge8Z",glider:"diff-image-ext__glider-AQuzd",tabs:"diff-image-ext__tabs-EPrGf"}},648:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ElementId=t.TAB_CONTAINERS_BY_TAB=t.TAB_CONTAINER_IDS=t.TAB_LABELS=t.TABS_RADIO_GROUP_NAME=t.DEFAULT_SELECTED_TAB=t.PR_CHANGED_IMAGE_SELECTOR=void 0,t.PR_CHANGED_IMAGE_SELECTOR='[data-testid="file-content"] [data-testid="image-diff"] img',t.DEFAULT_SELECTED_TAB="tab-side-by-side",t.TABS_RADIO_GROUP_NAME="diff-tabs-group",t.TAB_LABELS=[["tab-side-by-side","Side by side"],["tab-difference","Difference"],["tab-overlay","Overlay"]],t.TAB_CONTAINER_IDS={sideBySide:"diff-side-by-side",difference:"diff-difference",overlay:"diff-overlay"},t.TAB_CONTAINERS_BY_TAB={"tab-side-by-side":"diff-side-by-side","tab-difference":"diff-difference","tab-overlay":"diff-overlay"},(i=t.ElementId||(t.ElementId={})).DiffOverlayContainer="image-diff-extension-container",i.Tabs="image-diff-tabs",i.OverlayOpacityInput="overlay-opacity-input",i.DifferenceImageCanvas="diff-difference-image-canvas",i.ImageBefore="image-before",i.ImageAfter="image-after",i.ImageDiffStats="image-diff-stats",i.ImageDiffStatsBefore="image-diff-stats-before",i.ImageDiffStatsAfter="image-diff-stats-after",i.ImageDiffStatsRatio="image-diff-stats-ratio"},918:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,d){function f(e){try{o(n.next(e))}catch(e){d(e)}}function r(e){try{o(n.throw(e))}catch(e){d(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(f,r)}o((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createDiffCanvasAndStats=void 0;const a=i(762);function d(e){const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;const i=t.getContext("2d");return(0,a.assertCanvasContext)(i),i.drawImage(e,0,0),t}function f(e){return e.data.reduce(((e,t,i)=>(i%4==0?e.push([t]):e[e.length-1].push(t),e)),[])}t.createDiffCanvasAndStats=function(e,t){return n(this,void 0,void 0,(function*(){yield function(...e){return new Promise((t=>{const i=e.map((e=>e.complete)),n=()=>{i.every(Boolean)&&t()};e.forEach(((e,t)=>{e.addEventListener("load",(()=>{i[t]=!0,n()}))})),n()}))}(e,t);const i={width:e.naturalWidth,height:e.naturalHeight},n={width:t.naturalWidth,height:t.naturalHeight};if(i.width!==n.width||i.height!==n.height)return{canvas:null,sizeBefore:i,sizeAfter:n};const r=e.naturalWidth,o=e.naturalHeight,s=d(e),l=d(t),c=s.getContext("2d");(0,a.assertCanvasContext)(c);const u=l.getContext("2d");(0,a.assertCanvasContext)(u);const m=c.getImageData(0,0,r,o),v=u.getImageData(0,0,r,o),y=f(m),g=f(v),_=y.map(((e,t)=>{if(e.join(",")===g[t].join(","))return e})),h=_.filter((e=>void 0===e)).length,I=h/y.length,E=_.reduce(((e,t,i)=>{const n=null!=t?t:[255,0,0,255];return e[4*i]=n[0],e[4*i+1]=n[1],e[4*i+2]=n[2],e[4*i+3]=n[3],e}),new Uint8ClampedArray(4*_.length)),p=document.createElement("canvas");p.width=r,p.height=o;const A=p.getContext("2d");(0,a.assertCanvasContext)(A);const b=new ImageData(E,r,o);return A.putImageData(b,0,0),{canvas:p,numDifferentPixels:h,differentPixelsRatio:I,sizeBefore:i,sizeAfter:n}}))}},656:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDiffCanvasAndStats=void 0;var n=i(918);Object.defineProperty(t,"createDiffCanvasAndStats",{enumerable:!0,get:function(){return n.createDiffCanvasAndStats}})},623:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,d){function f(e){try{o(n.next(e))}catch(e){d(e)}}function r(e){try{o(n.throw(e))}catch(e){d(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(f,r)}o((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createOverlayContainer=void 0;const a=i(648),d=i(762),f=i(967);function r(e){if((0,d.queryById)(e,a.ElementId.DiffOverlayContainer))return;const t=e.ownerDocument.createElement("div");let i;function r(a){return n(this,void 0,void 0,(function*(){const n=e.ownerDocument.body;i=window.getComputedStyle(n).overflow;const d=a.composedPath().find((e=>e instanceof HTMLElement&&"file-content"===e.getAttribute("data-testid")));if(!d)return;const r=Array.from(d.querySelectorAll('[data-testid="image-diff"] img')).map((e=>e.src));return 2===r.length?(n.style.overflow="hidden",t.style.display="block",window.addEventListener("keydown",o),(0,f.renderOverlay)(t,r[0],r[1],s)):void 0}))}function o(e){"Escape"===e.key&&s()}function s(){t.style.display="none",t.innerHTML="",e.ownerDocument.body.style.overflow=null!=i?i:"",i=void 0,window.removeEventListener("keydown",o)}t.id=a.ElementId.DiffOverlayContainer,t.setAttribute("data-testid","image-diff-extension-container"),t.style.position="relative",t.style.zIndex="9999",t.style.display="none",e.appendChild(t);let l=new Set;new MutationObserver((function(){e.querySelectorAll(a.PR_CHANGED_IMAGE_SELECTOR).forEach((e=>{l.has(e)||(e.addEventListener("click",r),e.style.cursor="pointer",l.add(e))}))})).observe(e,{subtree:!0,childList:!0,attributes:!1,characterData:!1})}t.createOverlayContainer=r,r(document.body)},204:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOverlayContainer=void 0;var n=i(623);Object.defineProperty(t,"createOverlayContainer",{enumerable:!0,get:function(){return n.createOverlayContainer}})},967:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,d){function f(e){try{o(n.next(e))}catch(e){d(e)}}function r(e){try{o(n.throw(e))}catch(e){d(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(f,r)}o((n=n.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.renderOverlay=void 0;const d=a(i(439)),f=a(i(456)),r=i(648),o=i(656),s=i(762),l={"diff-difference":d.default["diff-difference"],"diff-overlay":d.default["diff-overlay"],"diff-side-by-side":""},c=`${d.default["diff-item-container"]} ${d.default["diff-item-before"]}`,u=`${d.default["diff-item-container"]} ${d.default["diff-item-after"]}`;function m(e){return[d.default["diff-panel"],l[e],e!==r.TAB_CONTAINERS_BY_TAB[r.DEFAULT_SELECTED_TAB]&&d.default.hidden].filter(Boolean).join(" ")}t.renderOverlay=function(e,t,i,a){var l,v;return n(this,void 0,void 0,(function*(){e.innerHTML=`  <div class="${d.default["diff-backdrop"]}">\n    <div class="${d.default["diff-container"]}">\n      <div class="${f.default["image-diff-tabs"]} ${f.default.hidden}" id="${r.ElementId.Tabs}">\n      </div>\n\n      <div class="${m("diff-side-by-side")}" id="${r.TAB_CONTAINER_IDS.sideBySide}">\n        <div class="${c}">\n          <div>BEFORE</div>\n          <img class="${d.default["diff-item-image"]}" src="${t}" id="${r.ElementId.ImageBefore}" />\n        </div>\n        <div class="${u}">\n          <div>AFTER</div>\n          <img class="${d.default["diff-item-image"]}" src="${i}" id="${r.ElementId.ImageAfter}" />\n        </div>\n      </div>\n\n      <div class="${m("diff-difference")}" id="${r.TAB_CONTAINER_IDS.difference}">\n        <div class="${c}">\n          <canvas id="${r.ElementId.DifferenceImageCanvas}" class="${d.default["diff-item-image"]}" />\n        </div>\n      </div>\n\n      <div class="${m("diff-overlay")}" id="${r.TAB_CONTAINER_IDS.overlay}">\n        <div class="${d.default["diff-overlay-alpha-input"]}">\n          <input\n            type="range"\n            id="${r.ElementId.OverlayOpacityInput}"\n            name="${r.ElementId.OverlayOpacityInput}"\n            min="0"\n            max="1"\n            value="0.5"\n            step="0.01"\n          />\n          <label for="${r.ElementId.OverlayOpacityInput}">Overlay opacity</label>\n        </div>\n        <div class="${d.default["diff-images-stack"]}">\n          <div class="${c}">\n            <img class="${d.default["diff-item-image"]}" src="${t}" />\n          </div>\n          <div class="${u}">\n            <img class="${d.default["diff-item-image"]}" src="${i}" />\n          </div>\n        </div>\n      </div>\n      <div id="${r.ElementId.ImageDiffStats}" class="${d.default["diff-image-stats"]}">\n        <div id="${r.ElementId.ImageDiffStatsBefore}">\n        </div>\n        <div id="${r.ElementId.ImageDiffStatsAfter}">\n        </div>\n        <div id="${r.ElementId.ImageDiffStatsRatio}">\n        </div>\n      </div>\n    </div>\n  </div>`,function(e){const t=(0,s.queryById)(e,r.ElementId.Tabs);if(!t)throw new Error("Cannot find container to inject tab bar");for(const[i,n]of r.TAB_LABELS){const a=e.ownerDocument.createElement("input");a.type="radio",a.id=i,a.name=r.TABS_RADIO_GROUP_NAME,a.checked=i===r.DEFAULT_SELECTED_TAB,a.addEventListener("click",(()=>{Object.values(r.TAB_CONTAINER_IDS).forEach((t=>{var n;null===(n=(0,s.queryById)(e,t))||void 0===n||n.classList.toggle(d.default.hidden,r.TAB_CONTAINERS_BY_TAB[i]!==t)}))}));const o=e.ownerDocument.createElement("label");o.className=f.default.tab,o.setAttribute("for",i),o.innerHTML=n,t.append(a,o)}const i=e.ownerDocument.createElement("span");i.className=f.default.glider,t.appendChild(i)}(e);const n=e.querySelector(`.${d.default["diff-backdrop"]}`);null==n||n.addEventListener("click",(e=>{e.target===n&&a()}));const y=yield(0,o.createDiffCanvasAndStats)((0,s.queryById)(e,r.ElementId.ImageBefore),(0,s.queryById)(e,r.ElementId.ImageAfter));if((0,s.queryById)(e,r.ElementId.ImageDiffStatsBefore).innerHTML=`Before: ${y.sizeBefore.width} x ${y.sizeBefore.height}`,(0,s.queryById)(e,r.ElementId.ImageDiffStatsAfter).innerHTML=`After: ${y.sizeAfter.width} x ${y.sizeAfter.height}`,!y.canvas)return void((0,s.queryById)(e,r.ElementId.ImageDiffStatsRatio).innerHTML="Image size changed, diff is not available");null===(l=(0,s.queryById)(e,r.ElementId.Tabs))||void 0===l||l.classList.remove(f.default.hidden);const g=(0,s.queryById)(e,r.ElementId.OverlayOpacityInput);null==g||g.addEventListener("input",(e=>{document.documentElement.style.setProperty("--diff-overlay-opacity",e.currentTarget.value)}));const{canvas:_,differentPixelsRatio:h,numDifferentPixels:I}=y,E=_.getContext("2d");(0,s.assertCanvasContext)(E);const p=(0,s.queryById)(e,r.ElementId.DifferenceImageCanvas);p.width=_.width,p.height=_.height;const A=null!==(v=p.getContext("2d"))&&void 0!==v?v:null;(0,s.assertCanvasContext)(A);const b=E.getImageData(0,0,_.width,_.height);A.putImageData(b,0,0),(0,s.queryById)(e,r.ElementId.ImageDiffStatsRatio).innerHTML=`${I} different pixels (${(100*h).toFixed(2)}%)`}))}},762:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assertCanvasContext=t.queryById=void 0,t.queryById=(e,t)=>e.querySelector(`#${t}`),t.assertCanvasContext=function(e){if(!e)throw new Error("Failed to get canvas context")}}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var d=t[n]={exports:{}};return e[n].call(d.exports,d,d.exports,i),d.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i(485),(0,i(204).createOverlayContainer)(document.body)})();